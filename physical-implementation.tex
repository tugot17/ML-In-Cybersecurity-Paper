Successful attack in digital environment does not guarantee same success in the physical world. In contrast to the digital environment in real world we have to print eyeglass frames using some kind of 2d or 3d printer (in this case 2d) and then conduct an attack on a camera used by FRS. None printer is able to print every possible color. Every camera has a sampling error and is unable to capture colors 1:1. Because of that we have to apply slightly changes to the perturbation finding method.


\subsection{Robust Perturbations}
Because of changing condition such as image background, light conditions, attacker posture or his/her facial expression it's not fairly possible that two attacker's face images will be exactly the same. In initial assumption we assumed that \textit{Considered attacks should also be robust to changes in image conditions - light changes, attacker position changes, standing further/closer to camera shouldn'tâ€™t affect effectiveness of an attack}. That's why authors assumed that in order to successfully carry out attacks it is necessary to find perturbation $r$ such that it will be independent of exact image conditions. In other words we want to avoid some kind of \textit{overfitted} perturbation, but instead to find perturbation that will generalize beyond a single face image.

This was achieved by gathering a set of photos of the attacker $X$, taken in different conditions (changing background, lighting, facial expression, distance from the camera, head angle, etc.) and use that set $X$ to find a single perturbation $r$ that optimizes its objective for every input $x \in X$. We can formalize this as as optimization problem for both Impersonation (6) and Dodging (7):


\begin{equation}
\operatorname{argmin}_{r} \sum_{x \in X} \operatorname{softmaxloss}(f(x+r), c_t)
\end{equation}


\begin{equation}
\operatorname{argmin}_{r} \sum_{x \in X} \operatorname{- softmaxloss}(f(x+r), c_x)
\end{equation}

\subsection{Smooth transitions}

Natural images tend to contain smooth and regular patches, which are separated by a few edges. However generated perturbation eyeglass frames generated by minimizing \textit{softmaxloss} contain lot of edges and aren't very smooth. It might be a problem for cameras, because of sampling noise, extreme differences between neighboring pixels are unlikely to be accurately captured by camera. As a result non-smooth eyeglass frames may lead to not physically realizable attacks (which was paper initial assumption, see 6.1).

To achieve smooth perturbation we have to update the optimization function. Except minimizing \textit{softmaxloss} we have to also minimize \textit{total variation} ($TV$). For a perturbation $r$, $TV(r)$  is defined as: 

\begin{equation}
T V(r)=\sum_{i, j}\left(\left(r_{i, j}-r_{i+1, j}\right)^{2}+\left(r_{i, j}-r_{i, j+1}\right)^{2}\right)^{\frac{1}{2}}
\end{equation}

Where $r_{i,j}$ is an eyeglass frames pixel value at coordinates $(i,j)$. $TV(r)$ is low when the neighboring pixels have similar values (perturbation patch is smooth and regular) and high otherwise. A result of minimizing $TV(r)$ is smooth perturbation.
 
\subsection{Printability}

For printing an eyeglass frames authors have used a simple ink-jet printer - (Epson XP-83). It prints 2d eyeglass frames, but as any printer in the world it has some physical limitations. It can reproduce only a subset of the $[0,1]^3$ RGB color space not all possible colors. That's why in order to conduct successful attacks we need to limit perturbation to only colors reproducible by the printer. To do so authors defined \textit{non-printability score} ($NPS$). $NPS$  have high value for pixel of unreproducible color and low  otherwise. Let $P \subset [0,1]^3 $ be the set of printable RGB triplets. We
define the $NPS$ of a pixel $\hat{p}$ as: 

\begin{equation}
N P S(\hat{p})=\prod_{p \in P}|\hat{p}-p|
\end{equation}

To measure total $NPS$ for a perturbation $r$ we sum $NPS$ for each pixel $\hat{p}$ from a perturbation $r$. Instead of using all printable RGB triplets authors decided to pick the 30 triplets with a minimal variance in distances from the complete set of printable RGB triplets and use only them in the set $P$ used in definition of $NPS$. Authors claim that this optimization with using 30 \textit{centroids} worked great for them and lead to big improvements in physical realizability of an attack.


\subsection{Putting Everything Together}

Now we can to put everything together and model the new objective that will consist of \textit{misclassification} \textit{smoothness} and \textit{printability}. This new objective can be modeled as: 

\begin{equation}
\underset{r}{\operatorname{argmin}}\left(\sum_{x \in X} \operatorname{softmaxloss}\left(f(x+r), c_{t}\right)\right)+\kappa_{1} \cdot \operatorname{TV}(r)+\kappa_{2} \cdot \operatorname{NPS}(r)
\end{equation}

Where $\sum_{x \in X} \operatorname{softmaxloss}\left(x+r, c_{t}\right)$ is a \textit{misclassification} part (it is version for impersonation, for dodging it would be $\operatorname{argmin}_{r}\left(-\operatorname{softmaxloss}\left(f(x+r), c_{x}\right)\right)$), $\kappa_1$ and $\kappa_2$ are hyperparameters to balance \textit{smoothness} ($TV$) and \textit{printability} ($NPS$), $r$ is the perturbation we want to find and $X$ is a set of images of an attacker's face, 